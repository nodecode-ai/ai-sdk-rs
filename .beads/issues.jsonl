{"id":"ai-sdk-rs-62d","title":"Add regression tests for nested usage detail mapping","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: test-usage-nested-details-mapping\ntask: Add failing regression tests that assert mapping of input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens in non-stream and stream finish outputs.\nintegration points touched: ip-usage-details\nwhy: n/a\n\n### deliverables\n- Non-stream usage assertions in responses_language_model_tests.rs\n- Stream finish usage assertions in stream_fixture_tests.rs\n\n### acceptance\n- Tests fail on current behavior where nested details are not fully mapped\n- Tests are fixture-based and do not hit network\n\n### dependency intent\n- openai-parity-gap-matrix\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","notes":"[beads-claim] picked-by=mike@archlinux:2349549 picked-at=2026-02-14T02:13:40Z selector=next_unblocking.sh attempt=1 lock=/home/mike/nodecode/ai-sdk-rs/.beads/agent-picks/ai-sdk-rs-62d.lock","status":"closed","priority":1,"issue_type":"task","assignee":"pomterre","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:05.237686513-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:20:25.086942695-08:00","closed_at":"2026-02-13T18:20:25.086942695-08:00","close_reason":"Added failing regression assertions for nested usage detail mapping in non-stream generate and stream finish paths","labels":["openai","parity","tests","usage"],"dependencies":[{"issue_id":"ai-sdk-rs-62d","depends_on_id":"ai-sdk-rs-8uf","type":"blocks","created_at":"2026-02-13T18:02:43.923625414-08:00","created_by":"pomterre"}]}
{"id":"ai-sdk-rs-7jd","title":"Align response.failed stream finish semantics with TS","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: fix-stream-response-failed-finish\ntask: Adjust OpenAI Responses streaming parser/mapper so response.failed and error trajectories emit parity-aligned finish reason behavior.\nintegration points touched: ip-stream-failed-finish\nwhy: n/a\n\n### deliverables\n- Code updates in OpenAI stream chunk parsing and/or mapper finish logic\n- Updated comments explaining failed/error terminal semantics\n\n### acceptance\n- Stream response.failed regression test passes\n- Existing stream fixture suite continues to pass\n\n### dependency intent\n- test-stream-response-failed-finish\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","status":"open","priority":0,"issue_type":"bug","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:05.191999293-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:02:05.191999293-08:00","labels":["bugfix","openai","parity","stream"],"dependencies":[{"issue_id":"ai-sdk-rs-7jd","depends_on_id":"ai-sdk-rs-9jf","type":"blocks","created_at":"2026-02-13T18:02:43.884111236-08:00","created_by":"pomterre"}]}
{"id":"ai-sdk-rs-7td","title":"Implement nested usage detail parity mapping","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: fix-usage-nested-details-mapping\ntask: Update usage parsing/event mapping to preserve cached and reasoning token details in normalized usage outputs for generate and stream paths.\nintegration points touched: ip-usage-details\nwhy: n/a\n\n### deliverables\n- Code updates in OpenAI usage parsing and/or core event mapping\n- Reasoning token and cached token fields populated in normalized usage\n\n### acceptance\n- Nested usage detail regression tests pass\n- No unrelated provider usage tests regress\n\n### dependency intent\n- test-usage-nested-details-mapping\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","status":"open","priority":0,"issue_type":"bug","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:05.288647675-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:02:05.288647675-08:00","labels":["bugfix","openai","parity","usage"],"dependencies":[{"issue_id":"ai-sdk-rs-7td","depends_on_id":"ai-sdk-rs-62d","type":"blocks","created_at":"2026-02-13T18:02:43.972007109-08:00","created_by":"pomterre"}]}
{"id":"ai-sdk-rs-8uf","title":"Codify OpenAI Responses parity gap matrix and fixture mapping","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: openai-parity-gap-matrix\ntask: Create a short matrix mapping each identified parity gap to target Rust files, TS baseline lines, and required fixtures/tests so subsequent beads can execute without external context.\nintegration points touched: ip-nonstream-response-error, ip-stream-failed-finish, ip-usage-details, ip-function-tool-strict\nwhy: Front-loading an explicit parity matrix prevents ambiguous implementation and preserves plan intent if context is lost.\n\n### deliverables\n- Gap-to-file mapping note with Rust and TS references\n- Fixture/test inventory for each gap\n\n### acceptance\n- Each integration point has explicit target files and expected behavior\n- Each downstream bead can be executed using only bead description\n\n### dependency intent\n- none\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","notes":"[beads-claim] picked-by=mike@archlinux:2322790 picked-at=2026-02-14T02:04:24Z selector=next_unblocking.sh attempt=1 lock=/home/mike/nodecode/ai-sdk-rs/.beads/agent-picks/ai-sdk-rs-8uf.lock","status":"closed","priority":1,"issue_type":"task","assignee":"pomterre","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:04.999827916-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:09:39.463114799-08:00","closed_at":"2026-02-13T18:09:39.463114799-08:00","close_reason":"Added OpenAI Responses parity gap matrix with Rust/TS references and fixture/test mapping in docs/plans/openai-responses-parity-gap-matrix.md","labels":["openai","parity","planning"]}
{"id":"ai-sdk-rs-9jf","title":"Add stream regression test for response.failed finish behavior","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: test-stream-response-failed-finish\ntask: Add a failing stream fixture regression that asserts finish reason/terminal parts for response.failed and error chunks match TS baseline expectations.\nintegration points touched: ip-stream-failed-finish\nwhy: Finish reason drift is subtle and must be pinned with explicit terminal-stream assertions.\n\n### deliverables\n- New assertions in crates/providers/openai/tests/stream_fixture_tests.rs\n- Validation of terminal finish reason and metadata for openai-error fixture\n\n### acceptance\n- Test fails against current response.failed handling\n- Expected outcome is explicitly documented in assertion messages\n\n### dependency intent\n- openai-parity-gap-matrix\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","notes":"[beads-claim] picked-by=mike@archlinux:2343495 picked-at=2026-02-14T02:11:37Z selector=next_unblocking.sh attempt=1 lock=/home/mike/nodecode/ai-sdk-rs/.beads/agent-picks/ai-sdk-rs-9jf.lock","status":"closed","priority":1,"issue_type":"task","assignee":"pomterre","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:05.146023297-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:18:34.789063853-08:00","closed_at":"2026-02-13T18:18:34.789063853-08:00","close_reason":"Added stream error regression assertions for terminal finish reason/order and provider metadata parity against TS baseline (openai-error.1).","labels":["openai","parity","stream","tests"],"dependencies":[{"issue_id":"ai-sdk-rs-9jf","depends_on_id":"ai-sdk-rs-8uf","type":"blocks","created_at":"2026-02-13T18:02:43.844327938-08:00","created_by":"pomterre"}]}
{"id":"ai-sdk-rs-h3z","title":"Add regression test for do_generate response.error handling","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: test-do-generate-response-error\ntask: Add a failing regression test asserting OpenAI do_generate returns an error when response.error is present, using existing offline error fixtures.\nintegration points touched: ip-nonstream-response-error\nwhy: Locks expected behavior before implementation changes and prevents silent regressions.\n\n### deliverables\n- New/updated test in crates/providers/openai/tests/responses_language_model_tests.rs\n- Assertion that generation path throws/returns SdkError on response.error\n\n### acceptance\n- Test fails on current behavior and encodes TS parity expectation\n- Test is fixture-based and deterministic\n\n### dependency intent\n- openai-parity-gap-matrix\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","notes":"[beads-claim] picked-by=mike@archlinux:2338613 picked-at=2026-02-14T02:10:26Z selector=next_unblocking.sh attempt=1 lock=/home/mike/nodecode/ai-sdk-rs/.beads/agent-picks/ai-sdk-rs-h3z.lock","status":"closed","priority":1,"issue_type":"task","assignee":"pomterre","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:05.050432674-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:13:15.107245345-08:00","closed_at":"2026-02-13T18:13:15.107245345-08:00","close_reason":"Added fixture-based failing regression test for do_generate response.error propagation","labels":["openai","parity","tests"],"dependencies":[{"issue_id":"ai-sdk-rs-h3z","depends_on_id":"ai-sdk-rs-8uf","type":"blocks","created_at":"2026-02-13T18:02:43.758212661-08:00","created_by":"pomterre"}]}
{"id":"ai-sdk-rs-jmd","title":"Implement function tool strict passthrough in OpenAI requests","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: fix-function-tool-strict-passthrough\ntask: Extend relevant Rust types and OpenAI request builder serialization to preserve function tool strict mode exactly when provided.\nintegration points touched: ip-function-tool-strict\nwhy: n/a\n\n### deliverables\n- Type/model update for strict support where needed\n- OpenAI request serialization update to include strict when present\n\n### acceptance\n- Strict passthrough request-body tests pass\n- No breakage in existing function tool serialization tests\n\n### dependency intent\n- test-function-tool-strict-passthrough\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","status":"open","priority":0,"issue_type":"feature","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:05.388440132-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:02:05.388440132-08:00","labels":["openai","parity","serialization"],"dependencies":[{"issue_id":"ai-sdk-rs-jmd","depends_on_id":"ai-sdk-rs-vvn","type":"blocks","created_at":"2026-02-13T18:02:44.057154265-08:00","created_by":"pomterre"}]}
{"id":"ai-sdk-rs-pfo","title":"Implement do_generate response.error propagation parity","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: fix-do-generate-response-error\ntask: Update OpenAI Responses non-stream path to detect response.error and return mapped error instead of normal content.\nintegration points touched: ip-nonstream-response-error\nwhy: n/a\n\n### deliverables\n- Code change in crates/providers/openai/src/responses/language_model.rs\n- Any required error mapping helper adjustments\n\n### acceptance\n- Regression test for response.error handling passes\n- No unrelated non-stream OpenAI tests regress\n\n### dependency intent\n- test-do-generate-response-error\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","status":"open","priority":0,"issue_type":"bug","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:05.094327796-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:02:05.094327796-08:00","labels":["bugfix","openai","parity"],"dependencies":[{"issue_id":"ai-sdk-rs-pfo","depends_on_id":"ai-sdk-rs-h3z","type":"blocks","created_at":"2026-02-13T18:02:43.800908596-08:00","created_by":"pomterre"}]}
{"id":"ai-sdk-rs-vvn","title":"Add request serialization tests for function tool strict passthrough","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: test-function-tool-strict-passthrough\ntask: Add failing request-body serialization tests covering function tool strict=true, strict=false, and strict omitted behavior.\nintegration points touched: ip-function-tool-strict\nwhy: n/a\n\n### deliverables\n- New test cases in crates/providers/openai/tests/responses_language_model_tests.rs\n- Assertions on serialized tools[].strict field behavior\n\n### acceptance\n- Tests fail on current serialization behavior\n- Assertions cover true/false/unspecified strict scenarios\n\n### dependency intent\n- openai-parity-gap-matrix\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","notes":"[beads-claim] picked-by=mike@archlinux:2367372 picked-at=2026-02-14T02:19:04Z selector=next_unblocking.sh attempt=1 lock=/home/mike/nodecode/ai-sdk-rs/.beads/agent-picks/ai-sdk-rs-vvn.lock","status":"in_progress","priority":1,"issue_type":"task","assignee":"pomterre","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:05.342158217-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:19:04.641307217-08:00","labels":["openai","parity","serialization","tests"],"dependencies":[{"issue_id":"ai-sdk-rs-vvn","depends_on_id":"ai-sdk-rs-8uf","type":"blocks","created_at":"2026-02-13T18:02:44.013149285-08:00","created_by":"pomterre"}]}
{"id":"ai-sdk-rs-zl5","title":"Run OpenAI parity regression gate and publish closure note","description":"# atomic bead\n\n## full plan snapshot\nplan title: OpenAI Responses parity remediation for ai-sdk-rs\nplan summary: Close behavior drift between ai-sdk-rs OpenAI Responses provider and /home/mike/ai by fixing non-stream error propagation, response.failed streaming finish semantics, usage detail mapping, and function tool strict passthrough, with fixture-based regression coverage.\n\n### integration points (complete map)\n- [ip-nonstream-response-error] Non-stream response.error propagation\n  purpose: Ensure do_generate fails when OpenAI response payload contains top-level response.error, matching TS provider behavior.\n  integration contract: Given a response with response.error, ai-sdk-rs must surface an error instead of returning normal content.\n- [ip-stream-failed-finish] Streaming response.failed finish semantics\n  purpose: Align response.failed/error stream terminal behavior with TS finish reason semantics.\n  integration contract: For error/failed stream trajectories, finish reason and terminal parts match TS parity expectations.\n- [ip-usage-details] Usage details normalization\n  purpose: Map nested usage detail fields (cached and reasoning token details) into normalized usage outputs.\n  integration contract: input_tokens_details.cached_tokens and output_tokens_details.reasoning_tokens are preserved in normalized usage fields.\n- [ip-function-tool-strict] Function tool strict passthrough\n  purpose: Preserve function tool strict mode when building Responses API request bodies.\n  integration contract: Function tools include strict=true/false when specified and omit strict when unspecified.\n\n### global constraints\n- Scope is existing provider only: openai responses path in ai-sdk-rs.\n- Use fixture-based tests; no live provider API calls.\n- Preserve normalized stream contract in crates/sdk-types/src/v2.rs and avoid introducing incompatible stream part shapes.\n- Keep fixes localized to OpenAI provider/core mapping paths unless type support requires shared sdk-types changes.\n\n### definition of done\n- All four parity gaps are covered by deterministic tests and passing implementations.\n- OpenAI provider targeted tests pass for both request serialization and stream normalization paths.\n- No dependency cycles exist in bead graph and execution order reflects blocker intent.\n- Final parity note lists resolved gaps and any residual risk with file-level references.\n\n### plan assumptions\n- Current TS behavior in /home/mike/ai/packages/openai/src/responses is the parity baseline.\n- OpenAI fixture corpus in crates/providers/openai/tests/fixtures is authoritative for offline validation.\n- Rust stream finish behavior should align with TS snapshots for response.failed/error trajectories.\n\n### plan risks\n- Adjusting finish semantics may affect downstream consumers that implicitly depended on previous finish reasons.\n- Adding strict support may require shared type updates that can affect other providers if not isolated.\n- Usage mapping changes could unintentionally alter reported token accounting in unrelated tests.\n\n## bead-local scope\nbead key: openai-parity-regression-gate\ntask: Run the targeted OpenAI test suite after fixes, verify all parity expectations are green, and publish a concise closure note with any residual risk or follow-up beads.\nintegration points touched: ip-nonstream-response-error, ip-stream-failed-finish, ip-usage-details, ip-function-tool-strict\nwhy: A final gate bead prevents partial completion and ensures parity outcomes are explicitly verified.\n\n### deliverables\n- Targeted test run output summary\n- Closure note with resolved gaps and any follow-up issue IDs\n\n### acceptance\n- All newly added parity regressions pass\n- Any remaining drift is tracked as explicit follow-up bead(s)\n\n### dependency intent\n- fix-do-generate-response-error\n- fix-stream-response-failed-finish\n- fix-usage-nested-details-mapping\n- fix-function-tool-strict-passthrough\n\n## execution guardrail\npreserve plan compatibility invariants while delivering only this bead's scope.\n","status":"open","priority":0,"issue_type":"task","owner":"39233499+pomterre@users.noreply.github.com","created_at":"2026-02-13T18:02:33.914578082-08:00","created_by":"pomterre","updated_at":"2026-02-13T18:02:33.914578082-08:00","labels":["gate","openai","parity"],"dependencies":[{"issue_id":"ai-sdk-rs-zl5","depends_on_id":"ai-sdk-rs-pfo","type":"blocks","created_at":"2026-02-13T18:02:44.098241908-08:00","created_by":"pomterre"},{"issue_id":"ai-sdk-rs-zl5","depends_on_id":"ai-sdk-rs-7jd","type":"blocks","created_at":"2026-02-13T18:02:44.142478335-08:00","created_by":"pomterre"},{"issue_id":"ai-sdk-rs-zl5","depends_on_id":"ai-sdk-rs-7td","type":"blocks","created_at":"2026-02-13T18:02:44.184485227-08:00","created_by":"pomterre"},{"issue_id":"ai-sdk-rs-zl5","depends_on_id":"ai-sdk-rs-jmd","type":"blocks","created_at":"2026-02-13T18:02:44.228136297-08:00","created_by":"pomterre"}]}
